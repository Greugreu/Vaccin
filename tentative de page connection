<?php
try{
    $bdd = new PDO('mysql:host=localhost;dbname=login;charset=utf8', 'root', 'root');
}
catch (Exception $e)
{
    die('Erreur : '.$e->getMessage());
}
if(isset($_POST) && !empty($_POST['login']) && !empty($_POST['mdp'])) {
    extract($_POST);
    // on recupère le password de la table qui correspond au login du visiteur
    $sql = sprintf("SELECT mdp from conect where email='%s'", $email);
    $req = mysqli_query($sql) or die('Erreur SQL !<br>'.$sql.'<br>'.mysqli_error());

    $data = mysqli_fetch_assoc($req);

    if($data['mdp'] != $mdp) {
        echo '<p>Mauvais login / password. Merci de recommencer</p>';
        include('login.php'); // On inclut le formulaire d'identification
        exit;
    }
    else {
        session_start();
        $_SESSION['login'] = $email;

        echo 'Vous etes bien logué';
        // ici vous pouvez afficher un lien pour renvoyer
        // vers la page d'accueil de votre espace membres
    }
}
else {
    echo '<p>Vous avez oublié de remplir un champ.</p>';
    include('login.htm'); // On inclut le formulaire d'identification
    exit;
}


?>





<?php
try{
    $bdd = new PDO('mysql:host=localhost;dbname=login;charset=utf8', 'root', 'root');
}
catch (Exception $e)
{
    die('Erreur : '.$e->getMessage());
}
//  Récupération de l'utilisateur et de son pass hashé
$req = $bdd->prepare('SELECT email, mdp, confmdp FROM conect WHERE email = :email');
$email =$_POST['email'];
$req->execute(array(
    'email' => $email));
$resultat = $req->fetch();

// Comparaison du pass envoyé via le formulaire avec la base
$confmdp = password_verify($_POST['mdp'], $resultat['mdp']);

if (!$resultat)
{
    echo 'Mauvais identifiant ou mot de passe !';
}
else
{
    if ($confmdp) {
        session_start();
        $_SESSION['id'] = $resultat['id'];
        $email =$_POST['email'];
        $_SESSION['email'] = $email;
        echo 'Vous êtes connecté !';
    }
    else {
        echo 'Mauvais identifiant ou mot de passe !';
    }
}
